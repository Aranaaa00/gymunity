<header class="gym-header" role="banner" aria-label="Cabecera principal de Gymunity">
  <section class="gym-header__top">
    <a class="gym-header__logo" routerLink="/" aria-label="Gymunity, volver a la página de inicio">
      <span class="sr-only">Gymunity - Ir a inicio</span>
      <picture aria-hidden="true">
        <source media="(max-width: 480px)" srcset="assets/logo-blanco-small.webp">
        <source media="(max-width: 768px)" srcset="assets/logo-blanco-medium.webp">
        <img src="assets/logo-blanco-large.webp" alt="Logo de Gymunity" loading="eager" width="140" height="32" fetchpriority="high" decoding="async">
      </picture>
    </a>

    <search class="gym-header__buscador" role="search">
      <app-buscador placeholder="Buscar gimnasios..." (buscarConDebounce)="alBuscar($event)" />
    </search>

    <section class="gym-header__acciones">
      <app-theme-switcher class="gym-header__tema" />

      @if (usuarioAutenticado()) {
        <app-menu-usuario class="gym-header__menu-usuario" />
      } @else {
        <nav 
          #menuNav
          class="gym-header__nav" 
          [class.gym-header__nav--abierto]="menuAbierto()"
          role="navigation"
          aria-label="Opciones de acceso"
          [attr.aria-hidden]="!menuAbierto()">
          <app-boton variante="ghost" tamano="sm" ariaLabel="Abrir formulario de inicio de sesión" [tabIndex]="menuAbierto() ? 0 : -1" (click)="ejecutarYCerrar(abrirLogin.emit.bind(abrirLogin))">Iniciar Sesión</app-boton>
          <app-boton variante="primary" tamano="sm" ariaLabel="Abrir formulario de registro gratuito" [tabIndex]="menuAbierto() ? 0 : -1" (click)="ejecutarYCerrar(abrirRegistro.emit.bind(abrirRegistro))">Registrarse</app-boton>
        </nav>
      }

      <button 
        #botonHamburguesa
        type="button"
        (click)="alternarMenu()"
        class="gym-header__hamburguesa"
        [class.gym-header__hamburguesa--oculto]="usuarioAutenticado()"
        [attr.aria-label]="menuAbierto() ? 'Cerrar menú de navegación' : 'Abrir menú de navegación con opciones de inicio de sesión'"
        [attr.aria-expanded]="menuAbierto()">
        <app-icono [nombre]="menuAbierto() ? 'x' : 'menu'" />
      </button>
    </section>
  </section>
  
  <aside 
    class="gym-header__backdrop" 
    [class.gym-header__backdrop--visible]="menuAbierto()"
    (click)="cerrarMenu()"
    aria-hidden="true">
  </aside>

  <!-- Buscador flotante para móvil (fixed en bottom) -->
  <search class="gym-header__buscador-flotante">
    <app-buscador placeholder="Buscar gimnasios..." [expandido]="true" (buscarConDebounce)="alBuscar($event)" />
  </search>
</header>