<article class="inicio">
  @if (estaAutenticado()) {
    <header class="inicio__bienvenida" tabindex="0" [attr.aria-label]="'Hola ' + nombreUsuario() + ', bienvenido de nuevo a Gymunity'">
      <h1 class="inicio__saludo">
        ¡Hola <span class="inicio__nombre">{{ nombreUsuario() }}</span>!
      </h1>
      <h2 class="inicio__mensaje">Bienvenido de nuevo a Gymunity</h2>
    </header>
  } @else {
    <app-seccion-bienvenida
      [tituloLineas]="['Encuentra el gimnasio perfecto para ti,', 'según tu estilo y tus metas.']"
      [subtituloLineas]="['Tu entrenamiento comienza aquí.', 'Nosotros te ayudamos a dar el primer paso.']"
      textoBoton="Únete gratis"
      (accion)="abrirRegistro()">
    </app-seccion-bienvenida>
  }

  @if (cargando()) {
    <section class="inicio__gimnasios inicio__gimnasios--cargando" aria-live="polite">
      <p>Cargando gimnasios...</p>
    </section>
  } @else if (error()) {
    <section class="inicio__gimnasios inicio__gimnasios--error" role="alert">
      <p>{{ error() }}</p>
    </section>
  } @else {
    @if (estaAutenticado() && ciudadUsuario()) {
      <section class="inicio__gimnasios" role="region" [attr.aria-label]="'Gimnasios cercanos a ' + ciudadUsuario()">
        <header class="inicio__section-header">
          <a class="inicio__section-link" routerLink="/busqueda" [queryParams]="{ciudad: ciudadUsuario()}" [attr.aria-label]="'Ver todos los gimnasios en ' + ciudadUsuario()">
            <h2 class="inicio__section-title" tabindex="0">Gimnasios cercanos a <strong>{{ ciudadUsuario() }}</strong></h2>
            <span class="inicio__section-arrow" aria-hidden="true">›</span>
          </a>
        </header>
        @if (cargandoCercanos()) {
          <p class="inicio__gimnasios-cargando" aria-live="polite">Cargando gimnasios...</p>
        } @else if (gimnasiosCercanos().length > 0) {
          <ul class="inicio__gimnasios-grid" role="list" [attr.aria-label]="'Lista de ' + gimnasiosCercanos().length + ' gimnasios cercanos'">
            @for (gym of gimnasiosCercanos(); track trackByGimnasioId($index, gym)) {
              <li>
                <app-card
                  [id]="gym.id"
                  [title]="gym.nombre"
                  [subtitle]="gym.disciplinas"
                  [location]="gym.ciudad"
                  [valoracion]="gym.valoracionMedia"
                  [totalResenias]="gym.totalResenias"
                  [imageSrc]="gym.foto"
                  [priority]="$index < 2"
                  variant="vertical"
                />
              </li>
            }
          </ul>
        } @else {
          <p class="inicio__gimnasios-vacio">
            Aún no hay gimnasios en {{ ciudadUsuario() }}. ¡Pronto habrá más!
          </p>
        }
      </section>
    }

    <section class="inicio__gimnasios" role="region" aria-label="Gimnasios más populares">
      <header class="inicio__section-header">
        <a class="inicio__section-link" routerLink="/busqueda" [queryParams]="{orden: 'popular'}" aria-label="Ver todos los gimnasios más populares de Gymunity">
          <h2 class="inicio__section-title" tabindex="0">Gimnasios más populares</h2>
          <span class="inicio__section-arrow" aria-hidden="true">›</span>
        </a>
      </header>
      <ul class="inicio__gimnasios-grid" role="list" [attr.aria-label]="'Lista de ' + gimnasiosPopulares().length + ' gimnasios populares'">
        @for (gym of gimnasiosPopulares(); track trackByGimnasioId($index, gym)) {
          <li>
            <app-card
              [id]="gym.id"
              [title]="gym.nombre"
              [subtitle]="gym.disciplinas"
              [location]="gym.ciudad"
              [valoracion]="gym.valoracionMedia"
              [totalResenias]="gym.totalResenias"
              [imageSrc]="gym.foto"
              [priority]="$index < 2"
              variant="vertical"
            />
          </li>
        }
      </ul>
    </section>

    <section class="inicio__gimnasios" role="region" aria-label="Nuevos gimnasios">
      <header class="inicio__section-header">
        <a class="inicio__section-link" routerLink="/busqueda" [queryParams]="{orden: 'reciente'}" aria-label="Ver todos los gimnasios recién añadidos a Gymunity">
          <h2 class="inicio__section-title" tabindex="0">Nuevos gimnasios en Gymunity</h2>
          <span class="inicio__section-arrow" aria-hidden="true">›</span>
        </a>
      </header>
      <ul class="inicio__gimnasios-grid" role="list" [attr.aria-label]="'Lista de ' + gimnasiosRecientes().length + ' gimnasios nuevos'">
        @for (gym of gimnasiosRecientes(); track trackByGimnasioId($index, gym)) {
          <li>
            <app-card
              [id]="gym.id"
              [title]="gym.nombre"
              [subtitle]="gym.disciplinas"
              [location]="gym.ciudad"
              [valoracion]="gym.valoracionMedia"
              [totalResenias]="gym.totalResenias"
              [imageSrc]="gym.foto"
              variant="vertical"
            />
          </li>
        }
      </ul>
    </section>
  }
</article>
