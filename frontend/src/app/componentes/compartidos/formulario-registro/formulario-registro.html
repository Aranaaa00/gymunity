<header class="formulario-auth__header">
  <picture class="formulario-auth__logo">
    <source media="(max-width: 480px)" srcset="assets/logo-small.webp">
    <source media="(max-width: 768px)" srcset="assets/logo-medium.webp">
    <img src="assets/logo-large.webp" alt="Logo de Gymunity - Crear cuenta" loading="eager" width="180" height="40" fetchpriority="high" decoding="async">
  </picture>
  <p class="formulario-auth__tagline">Únete a la comunidad fitness</p>
</header>

<form class="formulario-auth" [formGroup]="registroForm" (ngSubmit)="onSubmit()" autocomplete="off">
  <fieldset class="formulario-auth__fieldset">
    <legend class="formulario-auth__legend">Crea tu perfil</legend>
    
    <app-campo-formulario
      label="Nombre de usuario"
      type="text"
      placeholder="@tu_nombre"
      inputId="registro-username"
      name="username"
      autocomplete="off"
      [formControl]="usernameControl"
      [required]="true"
      helpText="Entre 3 y 20 caracteres. Solo letras, números y guión bajo."
      [validando]="estaValidando('username')"
      [hasError]="usernameControl.touched && usernameControl.invalid"
      [errorMessage]="getErrorMessage('username')"
      [mensajeExito]="getMensajeExito('username')">
    </app-campo-formulario>

    <app-campo-formulario
      label="Tu nombre"
      type="text"
      placeholder="Cómo te llamamos"
      inputId="registro-fullname"
      name="fullName"
      autocomplete="off"
      [formControl]="fullNameControl"
      [required]="true"
      helpText="Entre 2 y 50 caracteres."
      [hasError]="fullNameControl.touched && fullNameControl.invalid"
      [errorMessage]="getErrorMessage('fullName')">
    </app-campo-formulario>
    
    <app-campo-formulario
      label="Email"
      type="email"
      placeholder="Para tu acceso seguro"
      inputId="registro-email"
      name="email"
      autocomplete="off"
      [formControl]="emailControl"
      [required]="true"
      helpText="Formato válido: usuario@dominio.com"
      [validando]="estaValidando('email')"
      [hasError]="emailControl.touched && emailControl.invalid"
      [errorMessage]="getErrorMessage('email')"
      [mensajeExito]="getMensajeExito('email')">
    </app-campo-formulario>

    <app-campo-formulario
      label="Ciudad"
      type="text"
      placeholder="Ej: Madrid, Barcelona..."
      inputId="registro-ciudad"
      name="ciudad"
      autocomplete="off"
      [formControl]="ciudadControl"
      [required]="true"
      helpText="Tu ciudad para mostrarte gimnasios cercanos."
      [validando]="estaValidando('ciudad')"
      [hasError]="ciudadControl.touched && ciudadControl.invalid"
      [errorMessage]="getErrorMessage('ciudad')"
      [mensajeExito]="getMensajeExito('ciudad')">
    </app-campo-formulario>
    
    <app-campo-formulario
      label="Contraseña"
      type="password"
      placeholder="Mínimo 8 caracteres"
      inputId="registro-password"
      name="password"
      autocomplete="new-password"
      [formControl]="passwordControl"
      [required]="true"
      helpText="La contraseña debe tener mínimo 8 caracteres, incluir mayúsculas, minúsculas y números."
      [hasError]="passwordControl.touched && passwordControl.invalid"
      [errorMessage]="getErrorMessage('password')">
    </app-campo-formulario>

    @if (passwordControl.value) {
      <section class="formulario-registro__fuerza" aria-label="Indicador de fuerza de la contraseña">
        <figure class="formulario-registro__fuerza-barra"
          role="meter"
          [attr.aria-valuenow]="fuerzaPassword().porcentaje"
          aria-valuemin="0"
          aria-valuemax="100"
          [attr.aria-label]="'Fuerza de la contraseña: ' + fuerzaPassword().mensaje">
          <span 
            class="formulario-registro__fuerza-progreso"
            [class.formulario-registro__fuerza-progreso--debil]="fuerzaPassword().nivel === 'debil'"
            [class.formulario-registro__fuerza-progreso--media]="fuerzaPassword().nivel === 'media'"
            [class.formulario-registro__fuerza-progreso--fuerte]="fuerzaPassword().nivel === 'fuerte'"
            [class.formulario-registro__fuerza-progreso--muy-fuerte]="fuerzaPassword().nivel === 'muy-fuerte'"
            [style.width.%]="fuerzaPassword().porcentaje">
          </span>
        </figure>
        <small class="formulario-registro__fuerza-mensaje" aria-live="polite">{{ fuerzaPassword().mensaje }}</small>
      </section>
    }
    
    <app-campo-formulario
      label="Confirmar contraseña"
      type="password"
      placeholder="Repite tu contraseña"
      inputId="registro-password2"
      name="password2"
      autocomplete="new-password"
      [formControl]="password2Control"
      [required]="true"
      helpText="Debe coincidir con la contraseña anterior."
      [hasError]="password2Control.touched && password2Control.invalid"
      [errorMessage]="getErrorMessage('password2')">
    </app-campo-formulario>
    
    <section class="formulario-auth__submit">
      <app-boton tipo="submit" [cargando]="cargando()">
        Empezar mi aventura
      </app-boton>
    </section>

    @if (errorServidor()) {
      <p class="formulario-auth__error-servidor" role="alert" aria-live="assertive">{{ errorServidor() }}</p>
    }

    <footer class="formulario-auth__footer">
      <p class="formulario-auth__alt">
        ¿Ya entrenas con nosotros? 
        <button 
          type="button" 
          class="formulario-auth__link" 
          (click)="irLogin.emit()"
          aria-label="Ya tengo cuenta, ir al formulario de inicio de sesión">
          Accede aquí
        </button>
      </p>
    </footer>
  </fieldset>
</form>
