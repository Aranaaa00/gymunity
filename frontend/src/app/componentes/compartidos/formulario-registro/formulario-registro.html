<header class="formulario-auth__header">
  <img src="assets/logo.png" alt="Gymunity" class="formulario-auth__logo">
</header>

<form class="formulario-auth" [formGroup]="registroForm" (ngSubmit)="onSubmit()">
  <fieldset class="formulario-auth__fieldset">
    <legend class="formulario-auth__legend">Crear cuenta</legend>
    
    <app-campo-formulario
      label="Nombre de usuario"
      type="text"
      placeholder="tu_usuario"
      inputId="registro-username"
      name="username"
      [formControl]="$any(usernameControl)"
      [required]="true"
      [validando]="estaValidando('username')"
      [hasError]="!!usernameControl?.touched && !!usernameControl?.invalid"
      [errorMessage]="getErrorMessage('username')"
      [mensajeExito]="getMensajeExito('username')">
    </app-campo-formulario>

    <app-campo-formulario
      label="Nombre completo"
      type="text"
      placeholder="Tu Nombre Completo"
      inputId="registro-fullname"
      name="fullName"
      [formControl]="$any(fullNameControl)"
      [required]="true"
      [hasError]="!!fullNameControl?.touched && !!fullNameControl?.invalid"
      [errorMessage]="getErrorMessage('fullName')">
    </app-campo-formulario>
    
    <app-campo-formulario
      label="Email"
      type="email"
      placeholder="tu@email.com"
      inputId="registro-email"
      name="email"
      [formControl]="$any(emailControl)"
      [required]="true"
      [validando]="estaValidando('email')"
      [hasError]="!!emailControl?.touched && !!emailControl?.invalid"
      [errorMessage]="getErrorMessage('email')"
      [mensajeExito]="getMensajeExito('email')">
    </app-campo-formulario>
    
    <app-campo-formulario
      label="Contraseña"
      type="password"
      placeholder="Mínimo 8 caracteres seguros"
      inputId="registro-password"
      name="password"
      [formControl]="$any(passwordControl)"
      [required]="true"
      [hasError]="!!passwordControl?.touched && !!passwordControl?.invalid"
      [errorMessage]="getErrorMessage('password')">
    </app-campo-formulario>

    @if (passwordControl?.value) {
      <section class="formulario-registro__fuerza">
        <figure class="formulario-registro__fuerza-barra">
          <span 
            class="formulario-registro__fuerza-progreso"
            [class.formulario-registro__fuerza-progreso--debil]="fuerzaPassword().nivel === 'debil'"
            [class.formulario-registro__fuerza-progreso--media]="fuerzaPassword().nivel === 'media'"
            [class.formulario-registro__fuerza-progreso--fuerte]="fuerzaPassword().nivel === 'fuerte'"
            [class.formulario-registro__fuerza-progreso--muy-fuerte]="fuerzaPassword().nivel === 'muy-fuerte'"
            [style.width.%]="fuerzaPassword().porcentaje">
          </span>
        </figure>
        <small class="formulario-registro__fuerza-mensaje">{{ fuerzaPassword().mensaje }}</small>
      </section>
    }
    
    <app-campo-formulario
      label="Confirmar contraseña"
      type="password"
      placeholder="Repite tu contraseña"
      inputId="registro-password2"
      name="password2"
      [formControl]="$any(password2Control)"
      [required]="true"
      [hasError]="!!password2Control?.touched && !!password2Control?.invalid"
      [errorMessage]="getErrorMessage('password2')">
    </app-campo-formulario>
    
    <section class="formulario-auth__submit">
      <app-boton tipo="submit" [disabled]="registroForm.invalid && registroForm.touched" [cargando]="cargando()">
        Crear cuenta
      </app-boton>
    </section>

    @if (errorServidor()) {
      <p class="formulario-auth__error-servidor">{{ errorServidor() }}</p>
    }

    <p class="formulario-auth__alt">
      ¿Ya tienes cuenta? 
      <button type="button" class="formulario-auth__link" (click)="irLogin.emit()">Iniciar sesión</button>
    </p>
  </fieldset>
</form>
