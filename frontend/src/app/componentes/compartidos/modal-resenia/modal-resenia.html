<aside 
  class="modal-resenia" 
  role="dialog" 
  aria-modal="true"
  aria-labelledby="modal-titulo"
  (click)="onBackdropClick($event)"
>
  <article class="modal-resenia__contenido">
    <button 
      type="button" 
      class="modal-resenia__cerrar" 
      [attr.aria-label]="'Cerrar formulario de reseña para ' + gimnasioNombre()"
      (click)="onCerrar()"
    >
      <app-icono nombre="x" tamano="md" />
    </button>

    <header class="modal-resenia__header">
      <h2 id="modal-titulo" class="modal-resenia__titulo">Dejar reseña</h2>
      <p class="modal-resenia__gimnasio">{{ gimnasioNombre() }}</p>
    </header>

    <section class="modal-resenia__cuerpo">
      <fieldset class="modal-resenia__valoracion">
        <legend class="modal-resenia__label">¿Cómo valorarías tu experiencia?</legend>
        <span 
          class="modal-resenia__estrellas" 
          role="radiogroup" 
          aria-required="true"
          aria-label="Valoración"
          [attr.aria-invalid]="intentoEnvio() && valoracion() === 0 || null"
          [attr.aria-describedby]="intentoEnvio() && valoracion() === 0 ? 'error-valoracion' : null"
          (mouseleave)="salirHover()"
        >
          @for (estrella of estrellas; track estrella) {
            <button
              type="button"
              class="modal-resenia__estrella"
              [class.modal-resenia__estrella--activa]="esActiva(estrella)"
              [attr.aria-checked]="valoracion() === estrella"
              [attr.aria-label]="estrella + (estrella === 1 ? ' estrella' : ' estrellas')"
              role="radio"
              (click)="seleccionarEstrella(estrella)"
              (mouseenter)="hoverEstrella(estrella)"
            >
              <app-icono nombre="star" tamano="lg" />
            </button>
          }
        </span>
        @if (intentoEnvio() && valoracion() === 0) {
          <small id="error-valoracion" class="modal-resenia__error" role="alert" aria-live="assertive">Selecciona una valoración de 1 a 5 estrellas para poder enviar tu reseña.</small>
        }
      </fieldset>

      <div class="modal-resenia__campo">
        <label for="textarea-comentario-resenia" class="sr-only">Tu comentario</label>
        <textarea
          id="textarea-comentario-resenia"
          class="modal-resenia__textarea"
          [class.modal-resenia__textarea--error]="intentoEnvio() && comentario().trim().length === 0"
          placeholder="Cuéntanos tu experiencia en este gimnasio..."
          rows="4"
          maxlength="1000"
          aria-required="true"
          [value]="comentario()"
          (input)="actualizarComentario($event)"
          [attr.aria-invalid]="intentoEnvio() && comentario().trim().length === 0 || null"
          [attr.aria-describedby]="'contador-comentario-resenia' + (intentoEnvio() && comentario().trim().length === 0 ? ' error-comentario' : '')"
        ></textarea>
        @if (intentoEnvio() && comentario().trim().length === 0) {
          <small id="error-comentario" class="modal-resenia__error" role="alert" aria-live="assertive">Escribe un comentario describiendo tu experiencia en el gimnasio.</small>
        }
        <span id="contador-comentario-resenia" class="modal-resenia__contador" aria-live="polite">{{ comentario().length }}/1000</span>
      </div>
    </section>

    <footer class="modal-resenia__acciones">
      <button 
        type="button" 
        class="modal-resenia__boton modal-resenia__boton--secundario"
        (click)="onCerrar()"
        [disabled]="enviando()"
        aria-label="Cancelar y cerrar sin guardar la reseña"
      >
        Cancelar
      </button>
      <button 
        type="button" 
        class="modal-resenia__boton modal-resenia__boton--primario"
        [disabled]="enviando()"
        (click)="onEnviar()"
        [attr.aria-label]="enviando() ? 'Enviando tu reseña, por favor espera' : 'Publicar tu reseña de ' + gimnasioNombre()"
      >
        @if (enviando()) {
          <app-icono nombre="loader" tamano="sm" class="modal-resenia__spinner" />
          Enviando...
        } @else {
          Enviar reseña
        }
      </button>
    </footer>
  </article>
</aside>
